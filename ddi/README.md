# Unix SVR4 Device Driver Interface (DDI)
This folder contains the source code for the SVR4 DDI. All of the
functions have been split from the original source file to be easily
edited and keep the source code organized.

## What does it contain?
The DDI contains functions that are to be added to the kernel to put
the interface presented to drivers in conformance with the DDI standard.
Of the functions added to the kernel, 17 are function equivalents of
existing macros in `sysmacros.h`, `map.h`, `stream.h`, and `param.h`.

## Additional functions
18 additional functions, are specified by DDI to exist in the kernel
and are implemented here, are shown below:
| Function                                                                                              | Source file        | Description                                                                 | Return value                                                                                                                               |
|-------------------------------------------------------------------------------------------------------|--------------------|-----------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| `int drv_getparm(unsigned long parm, unsigned long *valuep)`                                          | `ddi_drv.c`        | Stores the value of the kernel parameter associated with parm in valuep.    | 0 if parm is valid, 1 on failure.                                                                                                          |
| `int drv_setparm(unsigned long parm, unsigned long value)`                                            | `ddi_drv.c`        | Sets the value of the parameter associated with parm to value.              | 0 if parm is valid, 1 on failure.                                                                                                          |
| `void setmapwant(struct map *mp)`                                                                     | `ddi_setmapwant.c` | Increment the count on the wait flag of map pointed to by mp.               | None.                                                                                                                                      |
| `int physiock(void (*strat)(), struct buf *bp, dev_t dev, int rw, daddr_t devsize, struct uio *uiop)` | `ddi_physiock.c`   | Perform raw device I/O on block devices.                                    | 0 on success, non-zero on failure.                                                                                                         |
| `struct buf *getrbuf(long sleep)`                                                                     | `ddi_rbuf.c`       | Allocate space for buffer header.                                           | Buffer pointer on success, NULL on failure.                                                                                                |
| `void freerbuf(struct buf *bp)`                                                                       | `ddi_rbuf.c`       | Free up space allocated by `getrbuf()`.                                     | None.                                                                                                                                      |
| `addr_t physmap(paddr_t physaddr, ulong_t nbytes, uint_t flags)`                                      | `ddi_physmap.c`    | Allocate a virtual address mapping for a given range of physical addresses. | A virtual address, or NULL if the mapping cannot be allocated.                                                                             |
| `void physmap_free(addr_t vaddr, ulong_t nbytes, uint_t flags)`                                       | `ddi_physmap.c`    | Release a mapping allocated by `physmap()`.                                 | None.                                                                                                                                      |
| `major_t getemajor(dev_t dev)`                                                                        | `ddi_getemajor.c`  | Get external major number.                                                  | The external major number of the device given as argument.                                                                                 |
| `minor_t geteminor(dev_t dev)`                                                                        | `ddi_geteminor.c`  | Get external minor number.                                                  | The external minor number of the device given as argument.                                                                                 |
| `int etoimajor(major_t emajornum)`                                                                    | `ddi_etoimajor.c`  | Convert external major to internal major device number.                     | The internal major number.                                                                                                                 |
| `int itoemajor(major_t imajnum, int lastemaj)`                                                        | `ddi_itoemajor.c`  | Convert internal major to external major device number.                     | The external major number.                                                                                                                 |
| `clock_t drv_usectohz(clock_t microsecs)`                                                             | `ddi_drv.c`        | Convert from microsecond time units to system time units.                   | A zero or lower input returns 0, the maximum `clock_t` value on overflow, the system time units that correspond to microsecond time units. |
| `clock_t drv_hztousec(clock_t ticks)`                                                                 | `ddi_drv.c`        | Convert from system time units to microsecond time units.                   | A zero or lower input returns 0, `MAXCLOCK_T` on overflow, the microsecond time units that correspond to system time units.                |
| `void drv_usecwait(clock_t count)`                                                                    | `ddi_drv.c`        | Implements a busy-wait mechanism.                                           | None.                                                                                                                                      |
| `int drv_priv(cred_t *cr)`                                                                            | `ddi_drv.c`        | Determine if the supplied credentials identify a privileged process.        | 0 if privilege granted, EPERM on denial.                                                                                                   |
| `void pollwakeup(struct pollhead *php, short event)`                                                  | `ddi_pollwakeup.c` | Notify system of an event so processes sleeping in poll() can be awakened.  | None.                                                                                                                                      |
